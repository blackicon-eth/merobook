description: Social Network Bootstrap Workflow
name: Social Network Calimero Workflow

force_pull_image: true
auth_service: true

nodes:
  chain_id: testnet-1
  count: 2
  image: ghcr.io/calimero-network/merod:edge
  prefix: calimero-node

steps:
  # Step 1: Install the application on the first node
  - name: Install Application on Node 1
    type: install_application
    node: calimero-node-1
    path: logic/res/social_network.wasm
    dev: true
    outputs:
      app_id: applicationId

  # Step 2: Create a context using the installed application
  - name: Create Context on Node 1
    type: create_context
    node: calimero-node-1
    application_id: "{{app_id}}"
    outputs:
      context_id: contextId
      member_public_key: memberPublicKey

  # Step 3: Generate an identity on the second node
  - name: Create Identity on Node 2
    type: create_identity
    node: calimero-node-2
    outputs:
      public_key: publicKey

  # Step 4: Wait for identity creation to complete
  - name: Wait for Identity Creation
    type: wait
    seconds: 5

  # Step 5: Invite the second node to join the context
  - name: Invite Node 2 from Node 1
    type: invite_identity
    node: calimero-node-1
    context_id: "{{context_id}}"
    grantee_id: "{{public_key}}"
    granter_id: "{{member_public_key}}"
    capability: member
    outputs:
      invitation: invitation

  # Step 6: Join the context from the second node
  - name: Join Context from Node 2
    type: join_context
    node: calimero-node-2
    context_id: "{{context_id}}"
    invitee_id: "{{public_key}}"
    invitation: "{{invitation}}"

  # Step 7: Wait for node-2 to sync
  - name: Wait for Node 2 Sync
    type: wait
    seconds: 3

  # Step 8: Create demo users (all from node-1 to avoid sync issues)
  - name: Create User Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Alice"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Alice"
      bio: "Web3 enthusiast and decentralization advocate"
      public_key: "{{member_public_key}}"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      alice: result

  - name: Create User Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Bob"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob"
      bio: "Building the future of social networks"
      public_key: "demo_bob_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      bob: result

  - name: Create User Charlie
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Charlie"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Charlie"
      bio: "Just here to explore p2p tech"
      public_key: "{{public_key}}"
      wallet_address: null
    outputs:
      charlie: result

  - name: Create User Frank
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Frank"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Frank"
      bio: "Crypto enthusiast and blockchain developer"
      public_key: "demo_frank_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      frank: result

  - name: Create User Diana
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Diana"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Diana"
      bio: "Digital artist exploring Web3 and NFTs"
      public_key: "demo_diana_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      diana: result

  - name: Create User Eve
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Eve"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Eve"
      bio: "Smart contract developer and DeFi enthusiast"
      public_key: "demo_eve_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      eve: result

  - name: Create User George
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "George"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=George"
      bio: "Tech blogger covering blockchain innovations"
      public_key: "demo_george_key"
      wallet_address: null
    outputs:
      george: result

  - name: Create User Hannah
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Hannah"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Hannah"
      bio: "Community manager passionate about decentralization"
      public_key: "demo_hannah_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      hannah: result

  - name: Create User Ivan
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Ivan"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Ivan"
      bio: "Software engineer learning about peer-to-peer networks"
      public_key: "demo_ivan_key"
      wallet_address: null
    outputs:
      ivan: result

  - name: Create User Julia
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Julia"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Julia"
      bio: "Data scientist exploring blockchain analytics"
      public_key: "demo_julia_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      julia: result

  - name: Create User Kevin
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Kevin"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Kevin"
      bio: "Gaming enthusiast and metaverse explorer"
      public_key: "demo_kevin_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      kevin: result

  - name: Create User Luna
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Luna"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Luna"
      bio: "Product designer crafting Web3 experiences"
      public_key: "demo_luna_key"
      wallet_address: null
    outputs:
      luna: result

  - name: Create User Mike
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Mike"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Mike"
      bio: "Entrepreneur building on decentralized protocols"
      public_key: "demo_mike_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      mike: result

  - name: Create User Nina
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_user
    args:
      name: "Nina"
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Nina"
      bio: "Researcher studying decentralized social networks"
      public_key: "demo_nina_key"
      wallet_address: "0x82A29547CA8970c2aDECF4C2db7e364339f9a4B7"
    outputs:
      nina: result

  - name: Wait for Users to Propagate
    type: wait
    seconds: 3

  # Step 9: Create first demo post
  - name: Create Post 1
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_post
    args:
      author_id: "1"
      content: "Welcome to our p2p social network! ðŸŽ‰"
      image_url: null
    outputs:
      post1_result: result

  # Step 10: Wait for the post to propagate
  - name: Wait for Post 1
    type: wait
    seconds: 2

  # Step 11: Create second demo post
  - name: Create Post 2
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_post
    args:
      author_id: "2"
      content: "This is amazing! Decentralized social networking is the future! ðŸš€"
      image_url: "https://picsum.photos/seed/decentralized/800/600"
    outputs:
      post2_result: result

  # Step 12: Wait for the post to propagate
  - name: Wait for Post 2
    type: wait
    seconds: 2

  # Step 13: Create third demo post from Node 2
  - name: Create Post 3
    type: call
    node: calimero-node-2
    context_id: "{{context_id}}"
    executor_public_key: "{{public_key}}"
    method: create_post
    args:
      author_id: "3"
      content: "Just joined from node 2! This is so cool! ðŸŒŸ"
      image_url: null
    outputs:
      post3_result: result

  # Step 14: Wait for the post to propagate
  - name: Wait for Post 3
    type: wait
    seconds: 2

  # Step 14b: Create fourth demo post from Frank
  - name: Create Post 4
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: create_post
    args:
      author_id: "4"
      content: "Loving the decentralized future! Tips accepted ðŸ’°"
      image_url: "https://picsum.photos/seed/crypto/800/600"
    outputs:
      post4_result: result

  # Step 14c: Wait for the post to propagate
  - name: Wait for Post 4
    type: wait
    seconds: 2

  # Step 15: Like the first post (Charlie likes Alice's post)
  - name: Like Post 1
    type: call
    node: calimero-node-2
    context_id: "{{context_id}}"
    executor_public_key: "{{public_key}}"
    method: like_post
    args:
      post_id: "1"
      user_id: "3"
    outputs:
      like_result: result

  # Step 16: Get all posts to verify
  - name: Get All Posts
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: get_all_posts
    args: {}
    outputs:
      all_posts: result

  # Create follow relationships for a natural social network
  # Diana follows Alice, Bob, Eve, Hannah
  - name: Diana follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "5"
      followee_id: "1"

  - name: Diana follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "5"
      followee_id: "2"

  - name: Diana follows Eve
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "5"
      followee_id: "6"

  - name: Diana follows Hannah
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "5"
      followee_id: "8"

  # Eve follows Alice, Bob, Frank, Julia
  - name: Eve follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "6"
      followee_id: "1"

  - name: Eve follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "6"
      followee_id: "2"

  - name: Eve follows Frank
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "6"
      followee_id: "4"

  - name: Eve follows Julia
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "6"
      followee_id: "10"

  # George follows Alice, Diana, Hannah, Nina
  - name: George follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "7"
      followee_id: "1"

  - name: George follows Diana
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "7"
      followee_id: "5"

  - name: George follows Hannah
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "7"
      followee_id: "8"

  - name: George follows Nina
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "7"
      followee_id: "14"

  # Hannah follows Alice, Bob, Luna, Nina
  - name: Hannah follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "8"
      followee_id: "1"

  - name: Hannah follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "8"
      followee_id: "2"

  - name: Hannah follows Luna
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "8"
      followee_id: "12"

  - name: Hannah follows Nina
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "8"
      followee_id: "14"

  # Ivan follows Bob, Frank, Kevin
  - name: Ivan follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "9"
      followee_id: "2"

  - name: Ivan follows Frank
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "9"
      followee_id: "4"

  - name: Ivan follows Kevin
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "9"
      followee_id: "11"

  # Julia follows Alice, Eve, Luna, Nina
  - name: Julia follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "10"
      followee_id: "1"

  - name: Julia follows Eve
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "10"
      followee_id: "6"

  - name: Julia follows Luna
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "10"
      followee_id: "12"

  - name: Julia follows Nina
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "10"
      followee_id: "14"

  # Kevin follows Frank, Mike, Ivan
  - name: Kevin follows Frank
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "11"
      followee_id: "4"

  - name: Kevin follows Mike
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "11"
      followee_id: "13"

  - name: Kevin follows Ivan
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "11"
      followee_id: "9"

  # Luna follows Alice, Diana, Hannah, Julia
  - name: Luna follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "12"
      followee_id: "1"

  - name: Luna follows Diana
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "12"
      followee_id: "5"

  - name: Luna follows Hannah
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "12"
      followee_id: "8"

  - name: Luna follows Julia
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "12"
      followee_id: "10"

  # Mike follows Bob, Frank, Kevin
  - name: Mike follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "13"
      followee_id: "2"

  - name: Mike follows Frank
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "13"
      followee_id: "4"

  - name: Mike follows Kevin
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "13"
      followee_id: "11"

  # Nina follows Alice, George, Hannah, Julia
  - name: Nina follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "14"
      followee_id: "1"

  - name: Nina follows George
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "14"
      followee_id: "7"

  - name: Nina follows Hannah
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "14"
      followee_id: "8"

  - name: Nina follows Julia
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "14"
      followee_id: "10"

  # Charlie and Frank also follow some users
  - name: Charlie follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "3"
      followee_id: "1"

  - name: Charlie follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "3"
      followee_id: "2"

  - name: Frank follows Alice
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "4"
      followee_id: "1"

  - name: Frank follows Bob
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "4"
      followee_id: "2"

  - name: Frank follows Eve
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: follow_user
    args:
      follower_id: "4"
      followee_id: "6"

stop_all_nodes: false
restart: true
nuke: false
wait_timeout: 60
